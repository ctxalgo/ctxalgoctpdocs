---
title: Timer in strategies
layout: post
category: root
language: en
---

This example shows how to setup timers in strategies. There are two kinds of timers:

1. Alarm timer, which will trigger an on_time event at a given time.
2. Countdown timer, which will trigger an on_time event after a time duration. If a countdown timer
is set to be repeated, it will trigger an on_time after every time duration.

To add a timer in a strategy, use the `add_timer` method:

```python
    def add_timer(self, timer=None, trigger_time=None, timedelta=None, action=None, start=True):
```

You can specify an alarm timer or a countdown timer through the `timer` parameter. Or you can create an alarm timer
by just specifying the `trigger_time` parameter, which defines the time of the alarm timer. Or you can create a
countdown timer by specifying the `timedelta` parameter, which defines he time duration for the countdown timer.
The `action` action points to a callback, which will be invoked when the timer is triggered. If it is None,
the default `on_time` callback will be invoked when this timer is triggered. Every timer is given a unique name; in the
callback, you can use this name to distinguish between different timers. You can also specify different callback methods
for different timers.


```python
from datetime import time
from ctxalgoctp.ctp.backtesting_utils import *


class TimerStrategy(AbstractStrategy):
    def __init__(self, instrument_ids, strategy_period, parameters, base_folder,
                 periods=None, description=None, logger=None):
        AbstractStrategy.__init__(
            self, instrument_ids, parameters, base_folder, strategy_period=strategy_period,
            periods=periods, description=description, logger=logger)

    def on_before_run(self, strategy):
        # Add an alarm timer at 14 clock every trading day.
        self.add_timer(trigger_time=time(14, 0), action=self.on_14_clock)

    def on_14_clock(self, trigger_time, supposed_trigger_time, timer_name):
        print('Alarm timer triggered at: {}'.format(trigger_time))
        # Add a countdown timer which triggers every 15 minutes.
        self.add_timer(timedelta=timedelta(minutes=15), action=self.on_every_15_minutes_after_14_clock)

    def on_every_15_minutes_after_14_clock(self, trigger_time, supposed_trigger_time, timer_name):
        print('Countdown timer triggered at: {}'.format(trigger_time))

```

Now, backtest the strategy.


```python
start_date = '2014-01-01'  # Backtesting start date.
end_date = '2014-12-31'    # Backtesting end date.

# The values in config will be used to instantiate the strategy objects by the backtest method.
config = {
    'instrument_ids': ['IF99'],                      # We are trading this future instrument.
    'strategy_period': Periodicity.FIFTEEN_MINUTE,   # The ohlc bar granularity on which trading happens.
    'parameters': {}
}

report, data_source = backtest(TimerStrategy, config, start_date, end_date)
```

We can see the following messeges in console:

```python
Alarm timer triggered at: 2014-01-02 14:00:00
Countdown timer triggered at: 2014-01-02 14:15:00
Countdown timer triggered at: 2014-01-02 14:30:00
Countdown timer triggered at: 2014-01-02 14:45:00
Countdown timer triggered at: 2014-01-02 15:00:00
Countdown timer triggered at: 2014-01-02 15:15:00
Alarm timer triggered at: 2014-01-03 14:00:00
Countdown timer triggered at: 2014-01-03 14:15:00
Countdown timer triggered at: 2014-01-03 14:30:00
Countdown timer triggered at: 2014-01-03 14:45:00
Countdown timer triggered at: 2014-01-03 15:00:00
Countdown timer triggered at: 2014-01-03 15:15:00
```
